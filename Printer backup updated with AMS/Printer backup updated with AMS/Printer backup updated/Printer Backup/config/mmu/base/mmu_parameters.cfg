########################################################################################################################
# Happy Hare MMU Software
#
# Template file for MMU's with Virtual Selector (Type-B designs like Box Turtle, Night Owl, Angry Beaver, ...)
# This file omits selector and selector-servo configuration and a few other options that don't make sense
#
# EDIT THIS FILE BASED ON YOUR SETUP
#
# Copyright (C) 2022-2025  moggieuk#6538 (discord)
#                          moggieuk@hotmail.com
# This file may be distributed under the terms of the GNU GPLv3 license.
#
# Goal: Main configuration parameters for the klipper module
#
# (\_/)
# ( *,*)
# (")_(") Happy Hare Ready
#
# Notes:
#   Macro configuration is specified separately in 'mmu_macro_vars.cfg'.
#   Full details in https://github.com/moggieuk/Happy-Hare/tree/main/doc/configuration.md
#
[mmu]
happy_hare_version: 3.41			# Don't mess, used for upgrade detection

# MMU Hardware Limits --------------------------------------------------------------------------------------------------
# ██╗     ██╗███╗   ███╗██╗████████╗███████╗
# ██║     ██║████╗ ████║██║╚══██╔══╝██╔════╝
# ██║     ██║██╔████╔██║██║   ██║   ███████╗
# ██║     ██║██║╚██╔╝██║██║   ██║   ╚════██║
# ███████╗██║██║ ╚═╝ ██║██║   ██║   ███████║
# ╚══════╝╚═╝╚═╝     ╚═╝╚═╝   ╚═╝   ╚══════╝
#
# Define the physical limits of your MMU. These settings will be respected regardless of individual speed settings.
#
gear_max_velocity: 300			# Never to be exceeded gear velocity regardless of specific parameters
gear_max_accel: 1500			# Never to be exceeded gear acceleration regardless of specific parameters


# Logging --------------------------------------------------------------------------------------------------------------
# ██╗      ██████╗  ██████╗  ██████╗ ██╗███╗   ██╗ ██████╗ 
# ██║     ██╔═══██╗██╔════╝ ██╔════╝ ██║████╗  ██║██╔════╝ 
# ██║     ██║   ██║██║  ███╗██║  ███╗██║██╔██╗ ██║██║  ███╗
# ██║     ██║   ██║██║   ██║██║   ██║██║██║╚██╗██║██║   ██║
# ███████╗╚██████╔╝╚██████╔╝╚██████╔╝██║██║ ╚████║╚██████╔╝
# ╚══════╝ ╚═════╝  ╚═════╝  ╚═════╝ ╚═╝╚═╝  ╚═══╝ ╚═════╝ 
#
# log_level & logfile_level can be set to one of (0 = essential, 1 = info, 2 = debug, 3 = trace, 4 = stepper moves)
# Generally you can keep console logging to a minimal whilst still sending debug output to the mmu.log file
# Increasing the console log level is only really useful during initial setup to save having to constantly open the log file
# Note: that it is not recommended to keep logging at level greater that 2 (debug) if not debugging an issue because
# of the additional overhead
#
log_level: 1
log_file_level: 2			# Can also be set to -1 to disable log file completely
log_statistics: 1 			# 1 to log statistics on every toolchange (default), 0 to disable (but still recorded)
log_visual: 1				# 1 log visual representation of filament, 0 = disable
log_startup_status: 1			# Whether to log tool to gate status on startup, 1 = summary (default), 0 = disable
log_m117_messages: 1			# Whether send toolchange message via M117 to screen


# Movement speeds ------------------------------------------------------------------------------------------------------
# ███████╗██████╗ ███████╗███████╗██████╗ ███████╗
# ██╔════╝██╔══██╗██╔════╝██╔════╝██╔══██╗██╔════╝
# ███████╗██████╔╝█████╗  █████╗  ██║  ██║███████╗
# ╚════██║██╔═══╝ ██╔══╝  ██╔══╝  ██║  ██║╚════██║
# ███████║██║     ███████╗███████╗██████╔╝███████║
# ╚══════╝╚═╝     ╚══════╝╚══════╝╚═════╝ ╚══════╝
#
# Long moves are faster than the small ones and used for the bulk of the bowden movement. You can set two fast load speeds
# depending on whether pulling from the spool or filament buffer (if fitted and not the first time load). This can be helpful
# in allowing faster loading from buffer and slower when pulling from the spool because of the additional friction (prevents
# loosing steps). Unloading speed can be tuning if you have a rewinder system that imposes additional limits.
# NOTE: Encoder cannot keep up much above 450mm/s so make sure 'bowden_apply_correction' is off at very high speeds!
#
gear_from_spool_speed: 80               # mm/s Speed when loading from the spool (for the first time if has_filament_buffer: 1)
gear_from_spool_accel: 100              # Acceleration when loading from spool
gear_from_buffer_speed: 80              # mm/s Speed matched to spool speed to prevent "takeoff" jump
gear_from_buffer_accel: 100             # Normal acceleration when loading filament
gear_unload_speed: 80                   # mm/s Use (lower) speed when unloading filament (defaults to "from spool" speed)
gear_unload_accel: 100                  # Acceleration when unloading filament (defaults to "from spool" accel)
#
gear_short_move_speed: 60		# mm/s Speed when making short moves (like incremental retracts with encoder)
gear_short_move_accel: 100		# Matched to main acceleration to prevent sudden jerks
gear_short_move_threshold: 70		# Move distance that controls application of 'short_move' speed/accel
gear_homing_speed: 25			# mm/s Speed of gear stepper only homing moves (e.g. homing to gate or extruder)

# Speeds of extruder movement. The 'sync' speeds will be used when gear and extruder steppers are moving in sync
#
extruder_load_speed: 15			# mm/s speed of load move inside extruder from homing position to meltzone
extruder_unload_speed: 15		# mm/s speed of unload moves inside of extruder (very initial move from meltzone is 50% of this)
extruder_sync_load_speed: 20		# mm/s speed of synchronized extruder load moves
extruder_sync_unload_speed: 20		# mm/s speed of synchronized extruder unload moves
extruder_homing_speed: 15		# mm/s speed of extruder only homing moves (e.g. to toolhead sensor)

# When Happy Hare calls out to a macro for user customization and for parking moves these settings are applied and the previous
# values automatically restored afterwards. This allows for deterministic movement speed regardless of the starting state.
#
macro_toolhead_max_accel: 0		# Default printer toolhead acceleration applied when macros are run. 0 = use printer max
macro_toolhead_min_cruise_ratio: 0.5	# Default printer cruise ratio applied when macros are run



# Gate loading/unloading -----------------------------------------------------------------------------------------------
#  ██████╗  █████╗ ████████╗███████╗    ██╗      ██████╗  █████╗ ██████╗ 
# ██╔════╝ ██╔══██╗╚══██╔══╝██╔════╝    ██║     ██╔═══██╗██╔══██╗██╔══██╗
# ██║  ███╗███████║   ██║   █████╗      ██║     ██║   ██║███████║██║  ██║
# ██║   ██║██╔══██║   ██║   ██╔══╝      ██║     ██║   ██║██╔══██║██║  ██║
# ╚██████╔╝██║  ██║   ██║   ███████╗    ███████╗╚██████╔╝██║  ██║██████╔╝
#  ╚═════╝ ╚═╝  ╚═╝   ╚═╝   ╚══════╝    ╚══════╝ ╚═════╝ ╚═╝  ╚═╝╚═════╝ 
#
# These settings control the loading and unloading filament at the gate which is the parking position inside the MMU.
# Typically this would be switch sensor but you can also use an encoder. Even with encoder the endstop can be a switch
# and the encoder used for move verifcation (see advanced 'gate_endstop_to_encoder' option). Note that the `encoder`
# method, due to the nature of its operation will overshoot a little. This is not a problem in practice because the
# overshoot will simply be compensated for in the subsequent move. A +ve parking distance moves towards the MMU, -ve
# moves back through the endstop towards the toolhead. If the MMU has multiple bowden tubes then it is possible to home
# at the extruder sensor and avoid long bowden moves!
#
# Possible gate_homing_endstop names:
#   encoder       - Detect filament position using movement of the encoder
#   mmu_gate      - Use gate endstop
#   mmu_gear      - Use individual per-gate endstop (type-B MMU's)
#   extruder      - Use extruder entry sensor (Only for some type-B designs, see [mmu_machine] require_bowden_move setting)
#
# Gate loading/unloading -----------------------------------------------------------------------------------------------
gate_homing_endstop: mmu_gate		# Correct: This uses your PG10 sensor as the reference point
gate_homing_max: 700			# Increased: Enough distance to reach PG10 from the pusher gears
gate_preload_homing_max: 0		# Set to 0: You don't have individual pre-gate sensors
gate_preload_parking_distance: 0	# Set to 0: Not applicable to your design 
gate_unload_buffer: 40			# Prevents filament from overshooting the PG10 sensor when retracting
gate_parking_distance: 115 		# Distance to back up from PG10 sensor once hit (keeps it clear of the splitter)
gate_endstop_to_encoder: 0		# Set to 0: You do not have an encoder
gate_autoload: 0			# Set to 0: You don't have pre-gate sensors to trigger autoload
gate_final_eject_distance: 280	# Distance to push filament out when you want to change spools



# Bowden tube loading/unloading ----------------------------------------------------------------------------------------
# ██████╗  ██████╗ ██╗    ██╗██████╗ ███████╗███╗   ██╗    ██╗      ██████╗  █████╗ ██████╗ 
# ██╔══██╗██╔═══██╗██║    ██║██╔══██╗██╔════╝████╗  ██║    ██║     ██╔═══██╗██╔══██╗██╔══██╗
# ██████╔╝██║   ██║██║ █╗ ██║██║  ██║█████╗  ██╔██╗ ██║    ██║     ██║   ██║███████║██║  ██║
# ██╔══██╗██║   ██║██║███╗██║██║  ██║██╔══╝  ██║╚██╗██║    ██║     ██║   ██║██╔══██║██║  ██║
# ██████╔╝╚██████╔╝╚███╔███╔╝██████╔╝███████╗██║ ╚████║    ███████╗╚██████╔╝██║  ██║██████╔╝
# ╚═════╝  ╚═════╝  ╚══╝╚══╝ ╚═════╝ ╚══════╝╚═╝  ╚═══╝    ╚══════╝ ╚═════╝ ╚═╝  ╚═╝╚═════╝ 
#
# Bowden tube loading/unloading ----------------------------------------------------------------------------------------
bowden_homing_max: 2000			# Keep: This is for initial tube length calibration

# Encoder settings (Disabled for your setup)
bowden_apply_correction: 0		# Keep 0: You don't have an encoder to correct with
bowden_allowable_load_delta: 20.0	# Ignored

# Safety Checks
bowden_pre_unload_test: 0		# SET TO 0: This requires an encoder. Your buffer switches handle sync instead.
bowden_pre_unload_error_tolerance: 50	# Ignored


# Extruder homing -----------------------------------------------------------------------------------------------------
# ███████╗██╗  ██╗████████╗    ██╗  ██╗ ██████╗ ███╗   ███╗██╗███╗   ██╗ ██████╗ 
# ██╔════╝╚██╗██╔╝╚══██╔══╝    ██║  ██║██╔═══██╗████╗ ████║██║████╗  ██║██╔════╝ 
# █████╗   ╚███╔╝    ██║       ███████║██║   ██║██╔████╔██║██║██╔██╗ ██║██║  ███╗
# ██╔══╝   ██╔██╗    ██║       ██╔══██║██║   ██║██║╚██╔╝██║██║██║╚██╗██║██║   ██║
# ███████╗██╔╝ ██╗   ██║██╗    ██║  ██║╚██████╔╝██║ ╚═╝ ██║██║██║ ╚████║╚██████╔╝
# ╚══════╝╚═╝  ╚═╝   ╚═╝╚═╝    ╚═╝  ╚═╝ ╚═════╝ ╚═╝     ╚═╝╚═╝╚═╝  ╚═══╝ ╚═════╝ 
#
# Happy Hare needs a reference "homing point" close to the extruder from which to accurately complete the loading of
# the toolhead. This homing operation takes place after the fast bowden load and it is anticipated that that load
# operation will leave the filament just shy of the homing point. If using a toolhead sensor this initial extruder
# homing is unnecessary (but can be forced) because the homing will occur inside the extruder for the optimum in accuracy.
# You still should set this homing method because it is also used for the determination and calibration of bowden length.
#
# In addition to an entry sensor "extruder" it is possible for Happy Hare to "feel" for the extruder gear entry
# by colliding with it. This can be done with encoder based collision detection, the compression of the sync-feedback
# (aka buffer) sensor or using "touch" (stallguard) on the gear stepper. Note that encoder collision detection is not
# completely deterministic and you will have to find the sweetspot for your setup by adjusting the TMC current reduction.
# Note that reduced current during collision detection can also prevent unecessary filament griding.
#
# Possible extruder_homing_endtop names:
#   collision            - Detect the collision with the extruder gear by monitoring encoder movement (Requires encoder)
#                          Fast bowden load will move to the extruder gears
#   mmu_gear_touch       - Use touch detection when the gear stepper hits the extruder (Requires stallguard)
#                          Fast bowden load will move to extruder_homing_buffer distance before extruder gear, then home
#   extruder             - If you have a "filament entry" endstop configured (Requires 'extruder' endstop)
#                          Fast bowden load will move to extruder_homing_buffer distance before sensor, then home
#   filament_compression - If you have a "sync-feedback" sensor with compression switch configured
#                          Fast bowden load will move to extruder_homing_buffer distance before extruder gear, then home
#   none                 - Don't attempt to home. Only possibiliy if lacking all sensor options
#                          Fast bowden load will move to the extruder gears. Option is fine if using toolhead sensor
# Note: The homing_endstop will be ignored ("none") if a toolhead sensor is available unless "extruder_force_homing: 1"
#
# Extruder homing -----------------------------------------------------------------------------------------------------
extruder_homing_max: 80			# Keep: plenty of room to find the gears
extruder_homing_endstop: filament_compression	# USE THIS: Uses your PG13 (High Limit) to detect the extruder gears
extruder_homing_buffer: 25		# Keep: slows down 25mm before the gears to prevent slamming
extruder_collision_homing_current: 100	# Keep 100: You aren't using encoder collision

# Toolhead sensor logic (You don't have one, so force homing is ignored)
extruder_force_homing: 0



# Toolhead loading and unloading --------------------------------------------------------------------------------------
# ████████╗ ██████╗  ██████╗ ██╗     ██╗  ██╗███████╗ █████╗ ██████╗     ██╗      ██████╗  █████╗ ██████╗ 
# ╚══██╔══╝██╔═══██╗██╔═══██╗██║     ██║  ██║██╔════╝██╔══██╗██╔══██╗    ██║     ██╔═══██╗██╔══██╗██╔══██╗
#    ██║   ██║   ██║██║   ██║██║     ███████║█████╗  ███████║██║  ██║    ██║     ██║   ██║███████║██║  ██║
#    ██║   ██║   ██║██║   ██║██║     ██╔══██║██╔══╝  ██╔══██║██║  ██║    ██║     ██║   ██║██╔══██║██║  ██║
#    ██║   ╚██████╔╝╚██████╔╝███████╗██║  ██║███████╗██║  ██║██████╔╝    ███████╗╚██████╔╝██║  ██║██████╔╝
#    ╚═╝    ╚═════╝  ╚═════╝ ╚══════╝╚═╝  ╚═╝╚══════╝╚═╝  ╚═╝╚═════╝     ╚══════╝ ╚═════╝ ╚═╝  ╚═╝╚═════╝ 
#
# Toolhead loading and unloading --------------------------------------------------------------------------------------
toolhead_homing_max: 40			# Keep: Distance to find gears via compression

# IMPORTANT: Adjust 'toolhead_extruder_to_nozzle' to your actual hotend length!
# For a Centari Carbon (Direct Drive), this is usually between 50mm and 90mm.
toolhead_extruder_to_nozzle: 44		# <--- MEASURE THIS (Gears to Nozzle tip)
toolhead_sensor_to_nozzle: 1.0		# Not fitted
toolhead_entry_to_extruder: 1.0		# Not fitted

# Calibration and Ooze Tuning
toolhead_residual_filament: 0		# Start at 0, adjust after first purge
toolhead_ooze_reduction: 0		# Start at 0, increase if you see blobs on the tower
toolhead_unload_safety_margin: 0	# Keep: ensures filament is clear of gears on retract

# Sync and Tension (Critical for your Buffer logic)
toolhead_post_load_tighten: 0		# Ignored because sync_to_extruder is 1
toolhead_post_load_tension_adjust: 1	# ENABLED: Uses your PG12/PG13 to center the slider after load
toolhead_entry_tension_test: 0		# ENABLED: Uses your PG13 to verify filament is actually in the gears

# Error Checking
toolhead_move_error_tolerance: 100	# Set to 100: You don't have an encoder to check movement



# Tip forming ---------------------------------------------------------------------------------------------------------
# ████████╗██╗██████╗     ███████╗ ██████╗ ██████╗ ███╗   ███╗██╗███╗   ██╗ ██████╗ 
# ╚══██╔══╝██║██╔══██╗    ██╔════╝██╔═══██╗██╔══██╗████╗ ████║██║████╗  ██║██╔════╝ 
#    ██║   ██║██████╔╝    █████╗  ██║   ██║██████╔╝██╔████╔██║██║██╔██╗ ██║██║  ███╗
#    ██║   ██║██╔═══╝     ██╔══╝  ██║   ██║██╔══██╗██║╚██╔╝██║██║██║╚██╗██║██║   ██║
#    ██║   ██║██║         ██║     ╚██████╔╝██║  ██║██║ ╚═╝ ██║██║██║ ╚████║╚██████╔╝
#    ╚═╝   ╚═╝╚═╝         ╚═╝      ╚═════╝ ╚═╝  ╚═╝╚═╝     ╚═╝╚═╝╚═╝  ╚═══╝ ╚═════╝ 
#
# Tip forming responsibility can be split between slicer (in-print) and standalone macro (not in-print) or forced to always
# be done by Happy Hare's standalone macro. Since you always need the option to form tips without the slicer so it is
# generally easier to completely turn off the slicer, force "standalone" tip forming and tune only in Happy Hare.
#
# When Happy Hare is asked to form a tip it will run the referenced macro. Two are reference examples are provided but
# you can implement your own:
#   _MMU_FORM_TIP .. default tip forming similar to popular slicers like Superslicer and Prusaslicer
#   _MMU_CUT_TIP  .. for Filametrix (originally ERCFv2) or similar style toolhead filament cutting system
#
# NOTE: For MMU located cutting like the optional EREC cutter you should set still this to _MMU_FORM_TIP to build a decent
# tip prior to extraction and cutting after the unload.
#
# Often it is useful to increase the extruder current for the rapid movement to ensure high torque and no skipped steps
#
# If opting for slicer tip forming you MUST configure where the slicer leaves the filament in the extruder since
# there is no way to determine this. This can be ignored if all tip forming is performed by Happy Hare
#
# Tip forming ---------------------------------------------------------------------------------------------------------
force_form_tip_standalone: 1		# KEEP 1: Let Happy Hare handle it. Turn off "MMU" or "Tip Forming" in your slicer.
form_tip_macro: CUT_FILAMENT
extruder_form_tip_current: 120		# INCREASE to 120: Gives your EBB36 extruder more torque to snap the filament tip
slicer_tip_park_pos: 0			# Ignored because of standalone mode


# Purging -------------------------------------------------------------------------------------------------------------
# ██████╗ ██╗   ██╗██████╗  ██████╗ ██╗███╗   ██╗ ██████╗ 
# ██╔══██╗██║   ██║██╔══██╗██╔════╝ ██║████╗  ██║██╔════╝ 
# ██████╔╝██║   ██║██████╔╝██║  ███╗██║██╔██╗ ██║██║  ███╗
# ██╔═══╝ ██║   ██║██╔══██╗██║   ██║██║██║╚██╗██║██║   ██║
# ██║     ╚██████╔╝██║  ██║╚██████╔╝██║██║ ╚████║╚██████╔╝
# ╚═╝      ╚═════╝ ╚═╝  ╚═╝ ╚═════╝ ╚═╝╚═╝  ╚═══╝ ╚═════╝ 
#
# After a toolchange it is necessary to purge the old filament. Similar to tip forming this can be done by the slicer and/or
# by Happy Hare using an extension like Blobifer. If a purge_macro is defined it will be called when not printing or whenever
# the slicer isn't going to purge (like initial tool load). You can force it to always be called in a print by setting
# force_purge_standalone, but remember to turn off the slicer wipetower
#
# The default is for no (empty) macro so purging will not be done out of a print and thus wipetower. Two options are shipped with
# Happy Hare but you can also build your own custom one:
#   _MMU_PURGE .. default purging that just dumps the desired amount of filament (setup correct parking before enabling this!)
#   BLOBIFER   .. for excellent Blobifer addon (https://github.com/Dendrowen/Blobifier)
#
# Often it is useful to increase the extruder current for the often rapid puring movement to ensure high torque and no skipped steps
#
# Purging -------------------------------------------------------------------------------------------------------------
force_purge_standalone: 1    # Change from 1 to 0
purge_macro: _MMU_PURGE			# Calls the standard purge, which we will wrap with your macros
extruder_purge_current: 110		# Increased to 110% for reliable high-speed purging


# Synchronized gear/extruder movement ----------------------------------------------------------------------------------
# ███╗   ███╗ ██████╗ ████████╗ ██████╗ ██████╗     ███████╗██╗   ██╗███╗   ██╗ ██████╗
# ████╗ ████║██╔═══██╗╚══██╔══╝██╔═══██╗██╔══██╗    ██╔════╝╚██╗ ██╔╝████╗  ██║██╔════╝
# ██╔████╔██║██║   ██║   ██║   ██║   ██║██████╔╝    ███████╗ ╚████╔╝ ██╔██╗ ██║██║     
# ██║╚██╔╝██║██║   ██║   ██║   ██║   ██║██╔══██╗    ╚════██║  ╚██╔╝  ██║╚██╗██║██║     
# ██║ ╚═╝ ██║╚██████╔╝   ██║   ╚██████╔╝██║  ██║    ███████║   ██║   ██║ ╚████║╚██████╗
# ╚═╝     ╚═╝ ╚═════╝    ╚═╝    ╚═════╝ ╚═╝  ╚═╝    ╚══════╝   ╚═╝   ╚═╝  ╚═══╝ ╚═════╝
#
# This controls whether the extruder and gear steppers are synchronized during printing operations
# If you normally run with maxed out gear stepper current consider reducing it with 'sync_gear_current'
# If equipped with TMC drivers the current of the gear and extruder motors can be controlled to optimize performance.
# This can be useful to control gear stepper temperature when printing with synchronized motor
#
sync_gear_current: 80		# % of gear_stepper current (10%-100%) to use when syncing with extruder during print

# Optionally it is possible to leverage feedback from a "compression/expansion" sensor (aka "buffer") in the bowden
# path from MMU to extruder to ensure that the two motors are kept in sync as viewed by the filament (the signal feedback
# state can be binary supplied by one or two switches: -1 (expanded) and 1 (compressed) of proportional value between
# -1.0 and 1.0.
#
# If only "one half" of the sync-feedback is available (either compression-only or tension-only) then the rotation
# distance is always shifted based on the high/low multipliers, however if both tension and compression are available
# then the rotation distance will autotune to correct setting (recommend you also enable 'autotune_rotation_distance: 1'
# Note that proportional feedback sensors are continuously dynamic
#
# Possible buffer setups, forth option for type where neutral is when both sensors are active:
#
#   <------maxrange------>       <------maxrange------>       <------maxrange------>       <------maxrange------>
#        <--range--->                  <----range----->       <----range----->                       <> range=0
#   |====================|       |====================|       |====================|       |====================|
#        ^          ^                  ^                                     ^                       ^^
#   compression   tension        compression-only                      tension-only
#

# --- DUAL-SWITCH FEEDBACK LOGIC ---
sync_to_extruder: 1             # Add this line to enable gear/extruder syncing
sync_feedback_enabled: 1		# ENABLED: This activates your PG12 and PG13 switches
sync_feedback_buffer_range: 25		# The "Deadzone" distance (mm) where no switches are pressed
sync_feedback_buffer_maxrange: 30	# The total physical travel (mm) of your slider

# These multipliers tell the pusher how much to speed up or slow down to stay in the deadzone
sync_multiplier_high: 1.90   # (Must be >= 1.0)
sync_multiplier_low: 0.50    # (Must be <= 1.0)




# ESpooler control -----------------------------------------------------------------------------------------------------
# ███████╗███████╗██████╗  ██████╗  ██████╗ ██╗     ███████╗██████╗ 
# ██╔════╝██╔════╝██╔══██╗██╔═══██╗██╔═══██╗██║     ██╔════╝██╔══██╗
# █████╗  ███████╗██████╔╝██║   ██║██║   ██║██║     █████╗  ██████╔╝
# ██╔══╝  ╚════██║██╔═══╝ ██║   ██║██║   ██║██║     ██╔══╝  ██╔══██╗
# ███████╗███████║██║     ╚██████╔╝╚██████╔╝███████╗███████╗██║  ██║
# ╚══════╝╚══════╝╚═╝      ╚═════╝  ╚═════╝ ╚══════╝╚══════╝╚═╝  ╚═╝
#                                                                  
# If your MMU has a dc motor (often N20) controlled respooler/assist then how it operates can be controlled with these
# settings. Typically the espooler will be controlled with PWM signal. This will be at the maximum at speeds equal or
# above 'espooler.max_stepper_speed'. The PWM signal will scale downwards towards 0 for slower speeds. The falloff being
# controlled by the 'espooler_speed_exponent' setting according to this formula and allows for non-linear characteristics
# the DC motor (0.5 is a good starting value).
# 
#     espooler_pwm = (stepper_speed / espooler_max_stepper_speed) ^ {espooler_speed_exponent}
#
# Regardless of h/w configuration you can enable/disable actions with the 'espooler_operations' list. E.g. remove 'play' to
# turn off operation while printing. Options are:
#
#    rewind - when filament is being unloaded under MMU control (aka respool)
#    assist - when filament is being loaded under MMU control (% of "rewind" speed but with minimum of "print" power)
#    print  - while printing. Generally set 'espooler_printing_power' to a low percentage just to allow motor to be turned
#             freely or set to 0 to enable/allow "burst" assist movements
#
# If using a digitally controlled espooler motor (not PWM) then you should turn off the "print" mode and set
# 'espooler_min_stepper_speed' to prevent "over movement"
#
espooler_min_distance: 30			# Individual stepper movements less than this distance will not active espooler
espooler_max_stepper_speed: 300			# Gear stepper speed at which espooler will be at maximum power
espooler_min_stepper_speed: 0			# Gear stepper speed at which espooler will become inactive (useful for non PWM control)
espooler_speed_exponent: 0.5			# Controls non-linear espooler power relative to stepper speed (see notes)
espooler_assist_reduced_speed: 50		# Control the % of the rewind speed that is applied to assisting load (want rewind to be faster)
espooler_printing_power: 0			# If >0, fixes the % of PWM power while printing. 0=allows burst movement
espooler_operations: rewind, assist, print	# List of operational modes (allows disabling even if h/w is configured)
#
# The following burst configuration is used only if 'print' operation is enabled and 'espooler_printing_power: 0'
#
espooler_assist_extruder_move_length: 100	# Distance (mm) extruder needs to move between each assist burst
espooler_assist_burst_power: 100		# The % power of the burst move
espooler_assist_burst_duration: 0.4		# The duration of the burst move is seconds
espooler_assist_burst_trigger: 0		# If trigger assist switch is fitted 0=disable, 1=enable
espooler_assist_burst_trigger_max: 3		# If trigger assist switch is fitted this limits the max number of back-to-back advances


# Filament Management Options ----------------------------------------------------------------------------------------
# ███████╗██╗██╗            ███╗   ███╗ ██████╗ ███╗   ███╗████████╗
# ██╔════╝██║██║            ████╗ ████║██╔════╝ ████╗ ████║╚══██╔══╝
# █████╗  ██║██║            ██╔████╔██║██║  ███╗██╔████╔██║   ██║   
# ██╔══╝  ██║██║            ██║╚██╔╝██║██║   ██║██║╚██╔╝██║   ██║   
# ██║     ██║███████╗██╗    ██║ ╚═╝ ██║╚██████╔╝██║ ╚═╝ ██║   ██║   
# ╚═╝     ╚═╝╚══════╝╚═╝    ╚═╝     ╚═╝ ╚═════╝ ╚═╝     ╚═╝   ╚═╝   
#
# Filament Management Options ----------------------------------------------------------------------------------------
enable_clog_detection: 0		# KEEP 0: Clog detection requires a physical encoder, which you don't have.
enable_endless_spool: 1			# KEEP 1: Allows automatic switching between "sister spools" (e.g., Slot 1 to Slot 2).
endless_spool_on_load: 0		# KEEP 0: Prevents confusion during initial manual loading.
endless_spool_eject_gate: -1		# KEEP -1: Ejects remains out of the current pusher motor/gate.

# Spoolman Support (Highly Recommended for Pi 5 users)
# If you use Spoolman to track your 5 colors, change 'off' to 'readonly'.
spoolman_support: off			
pending_spool_id_timeout: 20            

# UI Visualization
t_macro_color: gatemap			# CHANGE to 'gatemap': This shows your 5 gate colors in Mainsail/Fluidd.


# Print Statistics ---------------------------------------------------------------------------------------------------
# ███████╗████████╗ █████╗ ████████╗███████╗
# ██╔════╝╚══██╔══╝██╔══██╗╚══██╔══╝██╔════╝
# ███████╗   ██║   ███████║   ██║   ███████╗
# ╚════██║   ██║   ██╔══██║   ██║   ╚════██║
# ███████║   ██║   ██║  ██║   ██║   ███████║
# ╚══════╝   ╚═╝   ╚═╝  ╚═╝   ╚═╝   ╚══════╝
#
# These parameters determine how print statistic data is shown in the console. This table can show a lot of data,
# probably more than you'd want to see. Below you can enable/disable options to your needs.
#
# +-----------+---------------------+----------------------+----------+
# |  114(46)  |      unloading      |       loading        | complete |
# |   swaps   | pre  |   -   | post | pre  |   -   | post  |   swap   |
# +-----------+------+-------+------+------+-------+-------+----------+
# | all time  | 0:07 | 47:19 | 0:00 | 0:01 | 37:11 | 33:39 |  2:00:38 |
# |     - avg | 0:00 |  0:24 | 0:00 | 0:00 |  0:19 |  0:17 |     1:03 |
# | this job  | 0:00 | 10:27 | 0:00 | 0:00 |  8:29 |  8:30 |    28:02 |
# |     - avg | 0:00 |  0:13 | 0:00 | 0:00 |  0:11 |  0:11 |     0:36 |
# |      last | 0:00 |  0:12 | 0:00 | 0:00 |  0:10 |  0:14 |     0:39 |
# +-----------+------+-------+------+------+-------+-------+----------+
#             Note: Only formats correctly on Python3
#
# Comma separated list of desired columns
# Options: pre_unload, form_tip, unload, post_unload, pre_load, load, purge, post_load, total
console_stat_columns: unload, load, post_load, total

# Comma separated list of rows. The order determines the order in which they're shown.
# Options: total, total_average, job, job_average, last
console_stat_rows: total, total_average, job, job_average, last

# How you'd want to see the state of the gates and how they're performing
#   string     - poor, good, perfect, etc..
#   percentage - rate of success
#   emoticon   - fun sad to happy faces (python3 only)
console_gate_stat: emoticon

# Always display the full statistics table
console_always_output_full: 1	# 1 = Show full table, 0 = Only show totals out of print


# Calibration and autotune -------------------------------------------------------------------------------------------
#  ██████╗ █████╗ ██╗     ██╗██████╗ ██████╗  █████╗ ████████╗██╗ ██████╗ ███╗   ██╗
# ██╔════╝██╔══██╗██║     ██║██╔══██╗██╔══██╗██╔══██╗╚══██╔══╝██║██╔═══██╗████╗  ██║
# ██║     ███████║██║     ██║██████╔╝██████╔╝███████║   ██║   ██║██║   ██║██╔██╗ ██║
# ██║     ██╔══██║██║     ██║██╔══██╗██╔══██╗██╔══██║   ██║   ██║██║   ██║██║╚██╗██║
# ╚██████╗██║  ██║███████╗██║██████╔╝██║  ██║██║  ██║   ██║   ██║╚██████╔╝██║ ╚████║
#  ╚═════╝╚═╝  ╚═╝╚══════╝╚═╝╚═════╝ ╚═╝  ╚═╝╚═╝  ╚═╝   ╚═╝   ╚═╝ ╚═════╝ ╚═╝  ╚═══╝
#
# These are auto calibration/tuning settings that can be used to ease initial setup and/or to tune calibration over
# time based on measured telemetry. Whether these auto-tuning features are available depends on MMU design and
# configured sensors (explained below). The setting will be ignored if the required sensors are not available but if
# they can operate they will suppress the normal calibration warnings (MMU_STATUS can still be used to view them).
# Note that these are initially set by the installer to recommended values
#
#  autocal_bowden_length      - the calibrated bowden length will be established on first load. It can also be set
#                               manually or reset with MMU_CALIBRATE_BOWDEN. Best results require the use of
#                               sync-feedback-compression or extruder sensor but gear-touch or encoder will also work.
#                               'extruder_homing_endstop' cannot be 'none'
#  autotune_bowden_length     - Once calibrated this setting will tune the bowden distance over time. Works best with
#                               toolhead sensor
#  skip_cal_rotation_distance - This will rely on installed default value (although it can still be calibrated). Usually
#                               a good choice if autotune is enabled
#  autotune_rotation_distance - Requires sync-feedback sensor (aka "buffer") with both compression and tension switches
#                               or accurately calibrated encoder (encoder works only with gate 0)
#  skip_cal_encoder           - Will rely on installed default value (although it can still be calibrates).
#                               Not recommended but allows for easier initial setup especially when 'autotune_encoder'
#                               is enabled.
#  autotune_encoder           - NOT IMPLEMENTED YET. Soon!
#
# Calibration and autotune -------------------------------------------------------------------------------------------
autocal_bowden_length: 0	# KEEP 1: Automatically sets tube length on the very first load
autotune_bowden_length: 0	# KEEP 1: Refines tube length measurements during every toolchange
skip_cal_rotation_distance: 0	# SET TO 1: Skip the manual calibration because we will use autotune instead
autotune_rotation_distance: 0	# SET TO 1: EXTREMELY IMPORTANT for your 2-switch buffer slider
skip_cal_encoder: 1		# SET TO 1: You don't have an encoder, so skip this calibration
autotune_encoder: 0		# KEEP 0: Not applicable to your hardware



# Miscellaneous, but you should review -------------------------------------------------------------------------------
# ███╗   ███╗██╗███████╗ ██████╗
# ████╗ ████║██║██╔════╝██╔════╝
# ██╔████╔██║██║███████╗██║     
# ██║╚██╔╝██║██║╚════██║██║     
# ██║ ╚═╝ ██║██║███████║╚██████╗
# ╚═╝     ╚═╝╚═╝╚══════╝ ╚═════╝
#
# Miscellaneous, but you should review -------------------------------------------------------------------------------
timeout_pause: 72000		
disable_heater: 600		# Turns off nozzle after 10 mins of being stuck to prevent heat creep
default_extruder_temp: 220	# Set to your most common PLA/PETG temp for manual swaps
extruder_temp_variance: 2	

# Workflow options
startup_home_if_unloaded: 0	
startup_reset_ttg_map: 0	
show_error_dialog: 1		
preload_attempts: 2		# Lowered: Since you don't have gate sensors, no need for many "grabbing" attempts
strict_filament_recovery: 0	
filament_recovery_on_pause: 1	# KEEP 1: Helpful for your custom build to find filament after a jam
retry_tool_change_on_error: 0	# KEEP 0: Better to see why it failed during your first few prints
bypass_autoload: 0		# Not applicable
has_filament_buffer: 1          # MUST BE 1: This enables the logic for your PG12/PG13 switches

# Advanced options
encoder_move_validation: 0	# SET TO 0: You don't have an encoder! If set to 1, Klipper will error out.
print_start_detection: 1	
extruder: extruder		
gcode_load_sequence: 0		
gcode_unload_sequence: 0	


# ADVANCED: Klipper tuning -------------------------------------------------------------------------------------------
# ██╗  ██╗██╗     ██╗██████╗ ██████╗ ███████╗██████╗ 
# ██║ ██╔╝██║     ██║██╔══██╗██╔══██╗██╔════╝██╔══██╗
# █████╔╝ ██║     ██║██████╔╝██████╔╝█████╗  ██████╔╝
# ██╔═██╗ ██║     ██║██╔═══╝ ██╔═══╝ ██╔══╝  ██╔══██╗
# ██║  ██╗███████╗██║██║     ██║     ███████╗██║  ██║
# ╚═╝  ╚═╝╚══════╝╚═╝╚═╝     ╚═╝     ╚══════╝╚═╝  ╚═╝
#
# ADVANCED: Klipper tuning -------------------------------------------------------------------------------------------
update_trsync: 1		# SET TO 1: Vital for CANbus (EBB36) to prevent "Timer too close" during homing/loading.
canbus_comms_retries: 3		# KEEP 3: Provides a safety net for your EBB36 connection during tool changes.
update_bit_max_time: 1		# KEEP 1: Helpful even if you don't use MMU LEDs, as it stabilizes the system timing.
update_aht10_commands: 0	# KEEP 0: You are not using a BTT ViViD.


# ADVANCED: MMU macro overrides --- ONLY SET IF YOU'RE COMFORTABLE WITH KLIPPER MACROS -------------------------------
# ███╗   ███╗ █████╗  ██████╗██████╗  ██████╗ ███████╗
# ████╗ ████║██╔══██╗██╔════╝██╔══██╗██╔═══██╗██╔════╝
# ██╔████╔██║███████║██║     ██████╔╝██║   ██║███████╗
# ██║╚██╔╝██║██╔══██║██║     ██╔══██╗██║   ██║╚════██║
# ██║ ╚═╝ ██║██║  ██║╚██████╗██║  ██║╚██████╔╝███████║
# ╚═╝     ╚═╝╚═╝  ╚═╝ ╚═════╝╚═╝  ╚═╝ ╚═════╝ ╚══════╝
#
# ADVANCED: MMU macro overrides --------------------------------------------------------------------------------------
pause_macro: PAUSE 					# KEEP PAUSE: This calls your CC instance's standard pause
action_changed_macro: _MMU_ACTION_CHANGED		
print_state_changed_macro: _MMU_PRINT_STATE_CHANGED	
mmu_event_macro: _MMU_EVENT				

# The hooks below allow you to add custom sounds or movements
pre_unload_macro: _MMU_PRE_UNLOAD			
post_form_tip_macro: _MMU_POST_FORM_TIP			
post_unload_macro: _MMU_POST_UNLOAD			
pre_load_macro: _MMU_PRE_LOAD				
post_load_macro: _MMU_POST_LOAD				

# Leave these as the internal logic
unload_sequence_macro: _MMU_UNLOAD_SEQUENCE		
load_sequence_macro: _MMU_LOAD_SEQUENCE			


# ADVANCED: See documentation for use of these -----------------------------------------------------------------------
# ██████╗ ███████╗███████╗███████╗████████╗    ██████╗ ███████╗███████╗███████╗
# ██╔══██╗██╔════╝██╔════╝██╔════╝╚══██╔══╝    ██╔══██╗██╔════╝██╔════╝██╔════╝
# ██████╔╝█████╗  ███████╗█████╗     ██║       ██║  ██║█████╗  █████╗  ███████╗
# ██╔══██╗██╔══╝  ╚════██║██╔══╝     ██║       ██║  ██║██╔══╝  ██╔══╝  ╚════██║
# ██║  ██║███████╗███████║███████╗   ██║       ██████╔╝███████╗██║     ███████║
# ╚═╝  ╚═╝╚══════╝╚══════╝╚══════╝   ╚═╝       ╚═════╝ ╚══════╝╚═╝     ╚══════╝
#
# Gate:                #0      #1      #2      #3      #4
gate_status:           0,      0,      0,      0,      0
gate_filament_name:    1,      2,      3,      4,      5
gate_material:         Generic, Generic, Generic, Generic, Generic
gate_color:            eeeeee, eeeeee, eeeeee, eeeeee, eeeeee
gate_temperature:      0,      0,      0,      0,      0
gate_spool_id:         -1,     -1,     -1,     -1,     -1
gate_speed_override:   100,    100,    100,    100,    100
endless_spool_groups:  0,      1,      2,      3,      4

# Tool:                T0      T1      T2      T3      T4
tool_to_gate_map:      0,      1,      2,      3,      4



# SUPPLEMENTAL USER CONFIG retained after upgrade --------------------------------------------------------------------
#
